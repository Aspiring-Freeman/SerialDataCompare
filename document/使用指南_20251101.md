# 快速使用指南

更新日期：2025-11-01

## 一、启动程序

```bash
# 方法1：直接运行
./.qtcreator/Python_3_10_12venv/bin/python main_window.py

# 方法2：使用启动脚本
./run.sh

# 方法3：在VS Code中按F5调试运行
```

## 二、基本使用流程

### 1. 配置协议（首次使用）

1. 切换到"**协议配置**"标签页
2. 设置基本参数：
   - **帧头标识**：例如 `68`（十六进制）
   - **帧尾标识**：例如 `16`（十六进制）
   - **校验方式**：选择合适的校验算法（累加和、CRC16等）
   - **校验码字节数**：1-4字节
   - **校验范围**：
     - 起始偏移：从帧头后第几个字节开始（0表示紧跟帧头）
     - 结束偏移：负数表示从后往前数（-1表示到校验码前）

3. 定义数据字段：
   - 点击"**添加字段**"按钮添加字段
   - 双击表格单元格可以直接编辑：
     - 字段名称
     - 字节数（0表示变长）
     - 数据类型（uint8, uint16, int32, bytes等）
     - 说明
   - 使用"上移"/"下移"按钮调整字段顺序

4. 保存协议配置以备后用

### 2. 输入和分析数据

1. 切换到"**数据分析**"标签页
2. 在输入框中粘贴或输入串口数据
3. 点击"**开始分析**"按钮
4. 查看分析结果

## 三、测试示例

### 示例1：简单累加和校验

**协议配置：**
```
帧头：68
帧尾：16
校验方式：累加和
校验码字节数：1
校验范围：起始偏移 0，结束偏移 -1（从帧头后到校验码前）

字段定义：
1. 地址 - 1字节 - uint8 - 设备地址
2. 命令 - 1字节 - uint8 - 命令码
3. 长度 - 1字节 - uint8 - 数据长度
4. 数据 - 变长 - bytes - 数据内容（长度由"长度"字段决定）
```

**测试数据：**
```
68 01 03 02 AA BB 73 16
```

**数据说明：**
- `68` - 帧头
- `01` - 地址 = 1
- `03` - 命令 = 3
- `02` - 长度 = 2
- `AA BB` - 数据 = 0xAA 0xBB
- `73` - 校验码 = (01 + 03 + 02 + AA + BB) & 0xFF = 0x173 & 0xFF = 0x73
- `16` - 帧尾

**期望结果：**
- 识别1帧数据
- 所有字段正确解析
- 校验通过 ✓

### 示例2：多帧数据

**测试数据：**
```
68 01 05 01 CC D1 16
68 02 03 02 11 22 3C 16
```

**期望结果：**
- 识别2帧数据
- 每帧独立解析和校验

### 示例3：错误数据（校验失败）

**测试数据：**
```
68 01 03 02 AA BB FF 16
```

**数据说明：**
- 校验码 `FF` 是错误的（正确应该是 `73`）

**期望结果：**
- 识别1帧数据
- 字段正确解析
- 校验失败 ✗（显示期望0x73，实际0xFF）
- 该帧标记为红色

## 四、校验范围配置详解

### 累加和校验示例

假设帧格式：`68 AA BB CC DD CS 16`

**配置1：从帧头后所有数据到校验码前**
```
起始偏移：0
结束偏移：-1
```
校验范围：`AA BB CC DD`

**配置2：只校验中间部分**
```
起始偏移：1（跳过第一个字节AA）
结束偏移：-2（到倒数第二个字节前）
```
校验范围：`BB CC`

**配置3：指定绝对位置**
```
起始偏移：0
结束偏移：3（从帧头后第0到第3个字节）
```
校验范围：`AA BB CC DD`（共4个字节，位置0-3）

## 五、常见问题

### Q1：分析结果显示"数据格式错误"？
**A**：检查输入数据是否为有效的十六进制格式。确保：
- 只包含0-9, A-F字符
- 可以用空格、逗号分隔
- 字节数为偶数（两个字符一个字节）

### Q2：所有帧都显示校验失败？
**A**：检查校验配置：
1. 校验方式是否正确？
2. 校验码字节数是否正确？
3. 校验范围（起始/结束偏移）是否正确？

### Q3：无法识别数据帧？
**A**：检查：
1. 帧头、帧尾配置是否正确？
2. 输入数据是否包含完整的帧头和帧尾？

### Q4：字段解析不正确？
**A**：检查：
1. 字段顺序是否正确？
2. 字段字节数是否正确？
3. 数据类型是否匹配？
4. 变长字段的长度字段名称是否正确？

### Q5：移动字段后名称被重置？
**A**：这个问题已经修复。现在：
- 字段表格支持直接编辑
- 移动前会自动保存修改
- 双击单元格即可编辑

## 六、高级功能

### 导出结果
- 点击"导出结果"按钮
- 支持导出为TXT或CSV格式
- TXT格式包含详细的帧信息
- CSV格式方便在Excel中查看

### 协议管理
- 保存：将当前协议配置保存为JSON文件
- 加载：从JSON文件加载协议配置
- 重置：恢复到默认协议

### 数据类型支持
- `uint8`, `uint16`, `uint32` - 无符号整数（小端序）
- `int8`, `int16`, `int32` - 有符号整数（小端序）
- `float`, `double` - 浮点数
- `bytes` - 字节数组
- `string` - UTF-8字符串

## 七、技巧和建议

1. **保存常用协议**：将常用的协议配置保存为JSON文件，方便重复使用
2. **使用变长字段**：对于数据长度不固定的情况，设置字节数为0，并指定长度字段
3. **批量测试**：可以一次输入多行数据，程序会自动识别所有帧
4. **查看详情**：点击结果表格中的某一帧，下方会显示该帧的详细解析信息
5. **校验调试**：如果校验总是失败，可以尝试调整校验范围配置，观察期望值和实际值的差异

## 八、技术支持

如有问题或建议，请查看：
- 详细文档：`document/功能说明.md`
- 开发文档：`document/README_20251101.md`
- 项目仓库：[添加你的仓库地址]
